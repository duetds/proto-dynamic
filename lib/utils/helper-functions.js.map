{"version":3,"file":"helper-functions.js","sourceRoot":"","sources":["../../src/utils/helper-functions.ts"],"names":[],"mappings":"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","sourcesContent":["import { documentToHtmlString, type NodeRenderer } from \"@contentful/rich-text-html-renderer\"\nimport { BLOCKS, type Document, INLINES, type Inline } from \"@contentful/rich-text-types\"\nimport { nothing } from \"lit\"\nimport type { GroupItem } from \"../group/proto-dynamic-group\"\nimport type { ProtoButtonHandler, RichTextNode } from \"../hero/proto-dynamic-hero\"\nimport type { HighlightItem } from \"../highlight/proto-dynamic-highlight\"\n\n/* -------------------------------------------------------\n * Embedded entry types\n * ----------------------------------------------------- */\ntype ButtonLinkedItem = GroupItem | HighlightItem\n\ninterface EmbeddedEntry {\n  sys: { id: string; contentType: { sys: { id: string } } }\n  fields: Record<string, unknown>\n}\n\ninterface EmbeddedTargetFields {\n  key?: string\n  entry?: EmbeddedEntry\n  icon?: string\n  text?: string\n  richTextAppearance: string\n  heading?: string\n  body?: { content: RichTextNode[] }\n}\n\ninterface EmbeddedTarget {\n  sys: { contentType?: { sys?: { id?: string } } }\n  fields: EmbeddedTargetFields\n}\n\ninterface EmbeddedEntryData {\n  target: EmbeddedTarget\n  typeId?: string\n  key?: string\n  entry?: EmbeddedEntry\n  fields: EmbeddedTargetFields\n}\n\n/* -------------------------------------------------------\n * Proto button handlers & URL helpers\n * ----------------------------------------------------- */\n\nexport function isUrlExternal(url: string): boolean {\n  return !!url?.includes(\"https://\")\n}\n\nexport function getProtoButtonHandler(item: ButtonLinkedItem, protoButtonHandlers?: ProtoButtonHandler[]) {\n  return protoButtonHandlers?.find(b => b.buttonId === item.fields.key)\n}\n\nexport function getLinkUrl(item: ButtonLinkedItem, protoButtonHandlers?: ProtoButtonHandler[]) {\n  const button = getProtoButtonHandler(item, protoButtonHandlers)\n  return button?.url || item.fields.url || nothing\n}\n\nexport function handleLinkClick(item: ButtonLinkedItem, protoButtonHandlers?: ProtoButtonHandler[]) {\n  getProtoButtonHandler(item, protoButtonHandlers)?.clickHandler?.()\n}\n\n/* -------------------------------------------------------\n * RichText content handler\n * ----------------------------------------------------- */\nconst transformVariation = (resourceType: string) => {\n  switch (resourceType) {\n    case \"button-primary\":\n      return \"primary\"\n    case \"button-default\":\n      return \"default\"\n    case \"button-plain\":\n      return \"plain\"\n    case \"link-plain\":\n      return \"default\"\n    case \"link-button\":\n      return \"button\"\n    default:\n      return \"default\"\n  }\n}\n\nconst getEmbeddedEntryData = (node: RichTextNode | Inline): EmbeddedEntryData | null => {\n  const target = node.data?.target as EmbeddedTarget | undefined\n  if (!target?.fields) return null\n\n  return {\n    target,\n    typeId: target.sys?.contentType?.sys?.id,\n    key: target.fields.key,\n    entry: target.fields.entry,\n    fields: target.fields,\n  }\n}\n\nexport const renderRichText = (input: RichTextNode | RichTextNode[], data?: Record<string, unknown>): string => {\n  if (!input) return \"\"\n\n  let document: RichTextNode\n\n  if (Array.isArray(input)) {\n    document = { nodeType: \"document\", data: {}, content: input }\n  } else if (input.nodeType === \"document\") {\n    document = input\n  } else {\n    document = { nodeType: \"document\", data: {}, content: [input] }\n  }\n\n  return documentToHtmlString(document as Document, {\n    renderNode: {\n      [BLOCKS.PARAGRAPH]: (node, next) => `<duet-paragraph>${next(node.content)}</duet-paragraph>`,\n      [BLOCKS.HEADING_1]: (node, next) => `<duet-heading level=\"h1\">${next(node.content)}</duet-heading>`,\n      [BLOCKS.HEADING_2]: (node, next) => `<duet-heading level=\"h2\">${next(node.content)}</duet-heading>`,\n      [BLOCKS.HEADING_3]: (node, next) => `<duet-heading level=\"h3\">${next(node.content)}</duet-heading>`,\n      [BLOCKS.HEADING_4]: (node, next) => `<duet-heading level=\"h4\">${next(node.content)}</duet-heading>`,\n      [BLOCKS.HEADING_5]: (node, next) => `<duet-heading level=\"h5\">${next(node.content)}</duet-heading>`,\n      [BLOCKS.HEADING_6]: (node, next) => `<duet-heading level=\"h6\">${next(node.content)}</duet-heading>`,\n      [BLOCKS.EMBEDDED_ENTRY]: node => {\n        const embedded = getEmbeddedEntryData(node)\n        if (!embedded) return \"\"\n\n        const { typeId, fields } = embedded\n        if (!fields) return \"\"\n\n        switch (typeId) {\n          case \"collapsibleGroup\": {\n            const heading = node.data.target.fields.heading || \"\"\n            const collapsibleElements = (node.data.target.fields.items || []).map(renderCollapsibleElement).join(\"\") // join array into string\n            return renderCollapsibleGroup(heading, collapsibleElements)\n          }\n          case \"componentShowMore\":\n            return `<duet-show-more>${renderRichText(fields.body?.content ?? [])}</duet-show-more>`\n          case \"buttonResource\":\n            return renderButtonResource(embedded)\n          default:\n            return fields.body ? renderRichText(fields.body.content ?? []) : \"\"\n        }\n      },\n      [INLINES.EMBEDDED_ENTRY]: node => {\n        const embedded = getEmbeddedEntryData(node)\n        if (!embedded) return \"\"\n\n        const { typeId, key } = embedded\n        switch (typeId) {\n          case \"componentRichTextVariable\":\n            return key ? String(data?.[key] ?? `{{${key}}}`) : \"\"\n          case \"buttonResource\":\n            return renderButtonResource(embedded)\n          default:\n            return `${typeId}: {{${key}}}`\n        }\n      },\n      [BLOCKS.HR]: () => \"<duet-divider></duet-divider>\",\n    } as Record<string, NodeRenderer>,\n  })\n}\n\n/* -------------------------------------------------------\n * Resource renderers\n * ----------------------------------------------------- */\nconst renderButtonResource = (embedded: EmbeddedEntryData) => {\n  const { target, entry } = embedded\n  if (!entry || entry.sys.contentType.sys.id !== \"dynamicModal\") return \"\"\n\n  return `<duet-button\n    icon=${target.fields.icon}\n    variation=${transformVariation(target.fields.richTextAppearance)}\n    margin=\"none\"\n    onclick='this.dispatchEvent(new CustomEvent(\"open-dynamic-modal\", {\n      detail: { entryId: \"${entry.sys.id}\", fields: ${JSON.stringify(entry.fields)} },\n      bubbles: true,\n      composed: true\n    }))'>\n      ${target.fields.text}\n  </duet-button>`\n}\n\nconst renderCollapsibleElement = (item: EmbeddedEntryData) => {\n  return `<li><duet-collapsible \n    heading=\"${item.fields.heading || \"\"}\"\n    >${renderRichText(item.fields.body?.content ?? [])}\n    </duet-collapsible>\n    <duet-divider margin=\"small\"></duet-divider>\n  </li>`\n}\n\nconst renderCollapsibleGroup = (heading: string, collapsibleElements: string) => {\n  return `<style>\n    ul.collapsible-list {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    }\n    </style>\n    ${\n      heading &&\n      `<duet-heading level=\"h3\" visual-level=\"h4\">${heading}</duet-heading>\n    <duet-spacer size=\"small\"></duet-spacer>\n    <duet-divider margin=\"small\"></duet-divider>`\n    }\n     <ul class=\"collapsible-list\">\n     ${collapsibleElements}\n     </ul>`\n}\n"]}